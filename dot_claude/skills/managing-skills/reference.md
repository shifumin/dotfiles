# スキル管理 技術仕様

SKILL.md（`~/.claude/skills/managing-skills/SKILL.md`）から参照されるベストプラクティス詳細。

---

## 目次

1. descriptionの書き方
2. 自由度の設計指針
3. SKILL.mdテンプレート（CLI操作系）
4. SKILL.mdテンプレート（創造的タスク系）
5. reference.mdテンプレート
6. アンチパターン
7. 既存スキルの参考パターン
8. 既存スキル改善の観点
9. chezmoi固有の注意事項

---

## 1. descriptionの書き方

三人称で、「何をするか」+「いつ使うか（トリガー）」の両方を含める。

### 良い例

| description | 理由 |
|-------------|------|
| `Gmailのメール検索・取得を行う。「メールを検索」「〜からのメール」...` | 何をするか＋トリガーが明確 |
| `フロントエンドのUI・Webページ・コンポーネントを高品質なデザインで実装する。「UIを作って」...` | 対象範囲が具体的 |

### 悪い例

| description | 問題 |
|-------------|------|
| `便利なツール` | 曖昧すぎる |
| `ドキュメントを処理する` | いつ使うかが不明 |
| `<tool>メール検索</tool>` | XMLタグ禁止 |
| `2025年1月現在のAPI仕様に基づく` | 時間依存の情報 |

---

## 2. 自由度の設計指針

| 自由度 | 特徴 | 記述の具体性 | 該当スキル例 |
|--------|------|-------------|-------------|
| 低 | API操作、データ変換、壊れやすい | 具体的な手順・コマンド | gmail, google-calendar |
| 中 | 半構造的タスク | 手順＋判断ポイント | github |
| 高 | 創造的タスク | 方針・原則のみ | frontend-design |

**判断基準**: 「手順を間違えたら壊れるか？」→ Yes: 低自由度、No: 高自由度

---

## 3. SKILL.mdテンプレート（CLI操作系 / 低〜中自由度）

```yaml
---
description: {対象}の{操作}を行う。
  「{トリガー1}」「{トリガー2}」「{トリガー3}」などのリクエストで使用。
---
```

```markdown
# {スキル名}

## 操作の判定

| 操作 | トリガーとなる表現例 | 使用する手段 |
|------|---------------------|-------------|
| {操作1} | 「{表現}」 | {コマンド/ツール} |

---

## 共通設定

{パス、実行方法などの共通情報}

---

## {操作1}

### 処理フロー

1. ...
2. ...

### 実行コマンド

\`\`\`bash
{コマンド}
\`\`\`

### 出力の整形

\`\`\`markdown
{整形テンプレート}
\`\`\`

---

## エラー処理

| エラーパターン | 対処 |
|---------------|------|
| {エラー1} | {対処1} |

---

## 技術仕様

詳細は `~/.claude/skills/{name}/reference.md` を参照。
```

---

## 4. SKILL.mdテンプレート（創造的タスク系 / 高自由度）

```yaml
---
description: {対象}を{目的}。
  「{トリガー1}」「{トリガー2}」「{トリガー3}」などのリクエストで使用。
---
```

```markdown
# {スキル名}

{目的を1-2行で説明。Claudeへの期待を明記}

## 設計思考

{実装前に考えるべきポイント。箇条書きで}

## ガイドライン

{品質基準、推奨/禁止事項}

## 注意事項

{制約、避けるべきパターン}
```

---

## 5. reference.mdテンプレート

```markdown
# {スキル名}技術仕様

{SKILL.mdとの関係を1行で説明}

---

## {セクション1}

...

## {セクション2}

...
```

---

## 6. アンチパターン

| アンチパターン | 問題 | 対策 |
|---------------|------|------|
| Claudeが既知の情報を書く | context windowの無駄遣い | 差分情報のみ記載 |
| 選択肢を多数列挙 | 判断コスト増加 | 推奨を1つに絞り、代替はエスケープハッチで |
| 曖昧なスキル名 | トリガーの誤発火 | 具体的なgerund名 |
| 深いネスト参照 | 読み込み不完全のリスク | 1レベルまで |
| 時間依存の情報 | 陳腐化 | 「旧パターン」セクションで対応 |
| Windowsパス形式 | 環境依存 | UNIX形式（`/`）を使用 |
| 過度な説明 | トークン消費 | Claudeの既知情報は省略 |
| 一貫性のない用語 | 混乱 | 1概念1用語 |

---

## 7. 既存スキルの参考パターン

| スキル | 自由度 | 構成 | 特徴 |
|--------|--------|------|------|
| gmail | 低 | SKILL.md + reference.md | CLI wrapper、JSON整形、エラー処理 |
| google-calendar | 低 | SKILL.md.tmpl + reference.md | chezmoi template、CRUD操作 |
| github | 低〜中 | SKILL.md + reference.md | `gh` CLI wrapper、簡潔 |
| frontend-design | 高 | SKILL.md のみ | 創造的指示、方針のみ |

---

## 8. 既存スキル改善の観点

既存スキルを改善する際に確認すべきポイント。

### description

| チェック項目 | 具体的に確認すること |
|-------------|-------------------|
| トリガーの網羅性 | ユーザーが使いそうな表現がカバーされているか |
| 正確性 | スキルの実際の機能と一致しているか |
| 文字数 | 1024文字以内に収まっているか |

### 処理フロー

| チェック項目 | 具体的に確認すること |
|-------------|-------------------|
| ステップの明確さ | 各ステップが具体的で迷わないか |
| 抜け漏れ | 必要な手順が欠けていないか |
| エラー処理 | 失敗時の対処が記載されているか |

### 構造

| チェック項目 | 具体的に確認すること |
|-------------|-------------------|
| セクション構成 | 論理的な順序になっているか |
| テーブル活用 | 比較・一覧情報がテーブル化されているか |
| reference.md | 技術仕様が肥大化していないか、分離すべきか |

---

## 9. chezmoi固有の注意事項

| 項目 | 詳細 |
|------|------|
| 編集先 | `~/.local/share/chezmoi/dot_claude/skills/{name}/` |
| ターゲット | `~/.claude/skills/{name}/` |
| テンプレート | chezmoi変数を使う場合は `.tmpl` 拡張子 |
| 適用 | `chezmoi diff` → `chezmoi apply` |
| 直接編集禁止 | `~/.claude/skills/` を直接編集しない |
