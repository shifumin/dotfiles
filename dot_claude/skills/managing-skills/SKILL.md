---
description: Claude Codeのスキルの新規作成・既存スキルの改善を行う。
  「スキルを作成」「スキルを作って」「skillを作成」「create a skill」
  「スキルを改善」「スキルを更新」「improve skill」などのリクエストで使用。
---

# スキル管理

Anthropicの公式ベストプラクティスに沿って、Claude Codeスキルの新規作成・既存スキルの改善を行う。

## 操作の判定

| 操作 | トリガーとなる表現例 | 処理フロー |
|------|---------------------|-----------|
| 新規作成 | 「スキルを作成」「新しいスキル」 | → 新規作成フロー |
| 改善 | 「スキルを改善」「スキルを更新」 | → 改善フロー |

---

## 新規作成フロー

### Step 1: 要件の聞き取り

以下をAskUserQuestionで確認（不足時のみ）:

| 項目 | 確認内容 | 例 |
|------|---------|-----|
| 目的 | スキルが解決する問題 | 「GmailのメールをCLIで検索」 |
| トリガー | ユーザーが使う表現 | 「メールを検索」「search email」 |
| 自由度 | タスクの壊れやすさ | API操作=低、デザイン=高 |
| 外部ツール | 使用するCLI・MCP・スクリプト | `gh`, Ruby scripts |
| reference.md | 技術仕様が多いか | JSON構造、コマンド詳細がある場合は必要 |

### Step 2: 命名とディレクトリ作成

**命名規則**:

| ルール | 詳細 |
|--------|------|
| 形式 | gerund形式推奨（例: `processing-pdfs`） |
| 文字 | 小文字、数字、ハイフンのみ |
| 最大長 | 64文字 |
| 禁止 | 曖昧な名前（`utils`, `helper`）、`anthropic`・`claude`を含む名前 |

**作成先**:

```
~/.local/share/chezmoi/dot_claude/skills/{skill-name}/
  SKILL.md           # 必須
  reference.md       # 任意（技術仕様が多い場合）
```

**注意**: chezmoi管理下のため `~/.claude/skills/` を直接編集しないこと。

### Step 3: SKILL.md・reference.mdの作成

→ 共通: SKILL.md作成ルール を参照

### Step 4: CLAUDE.mdの更新

→ 共通: CLAUDE.md更新ルール を参照

### Step 5: 適用と検証

→ 共通: 適用と検証 を参照

---

## 改善フロー

### Step 1: 現状の把握

1. 対象スキルのSKILL.md（とreference.md）をReadツールで読み込む
2. 改善の目的をユーザーに確認（不明確な場合のみAskUserQuestion）

### Step 2: 改善点の特定

以下の観点で改善点を特定:

| 観点 | チェック項目 |
|------|-------------|
| description | トリガーキーワードの網羅性、正確性 |
| 処理フロー | ステップの明確さ、抜け漏れ |
| 構造 | セクション構成、テーブル活用 |
| reference.md | 要否の再検討、内容の過不足 |
| 品質基準 | 500行以下、簡潔さ、用語統一 |

### Step 3: 修正の適用

1. Editツールで改善を適用
2. 変更内容を観点別に報告

### Step 4: CLAUDE.mdの更新（必要時）

スキル名やトリガーキーワードが変わった場合のみ:
→ 共通: CLAUDE.md更新ルール を参照

### Step 5: 適用と検証

→ 共通: 適用と検証 を参照

---

## 共通: SKILL.md作成ルール

### frontmatter

```yaml
---
description: {スキルが何をするか}。
  「{トリガー1}」「{トリガー2}」「{トリガー3}」などのリクエストで使用。
---
```

| 項目 | ルール |
|------|--------|
| フィールド | `description` のみ（`name`は不要） |
| 人称 | 三人称（「〜を行う」「〜する」） |
| 言語 | 日本語。トリガー例も日本語で「」で囲む |
| 最大長 | 1024文字 |
| 禁止 | XMLタグ、時間依存の情報 |

### 本文の構成

| セクション | 内容 | 必須 |
|-----------|------|------|
| `# タイトル` | スキル名 | 必須 |
| 概要（1-2行） | スキルの目的 | 必須 |
| 操作の判定 | トリガー → 処理のマッピング表 | 推奨 |
| 処理フロー | 番号付きステップ | 必須 |
| 実行コマンド | コードブロック | 該当時 |
| 出力の整形 | Markdownテンプレート | 該当時 |
| エラー処理 | エラーパターンと対処の表 | 推奨 |
| 技術仕様参照 | reference.mdリンク | 該当時 |

### 品質基準

| 基準 | 詳細 |
|------|------|
| 行数 | 500行以下 |
| 簡潔さ | Claudeが既知の情報は省略 |
| 自由度 | 壊れやすい操作→具体的な手順、創造的作業→方針のみ |
| 用語統一 | 1つの概念に1つの用語 |
| フィードバックループ | 品質が重要な操作にはvalidate → fix → repeat |

---

## 共通: reference.mdの作成（任意）

### 作成が必要なケース

| ケース | 例 |
|--------|-----|
| JSON出力構造の仕様がある | Gmail、カレンダー |
| コマンドオプションが多い | CLI wrapper系スキル |
| 変換テーブル・マッピングがある | ラベル名変換、日付変換 |

### 構成ルール

| ルール | 詳細 |
|--------|------|
| 先頭 | `# {スキル名}技術仕様` + SKILL.mdとの関係を1行で |
| 100行超 | 冒頭に目次を追加 |
| 参照深度 | 1レベルまで（reference.mdから別ファイルを参照しない） |
| SKILL.mdからの参照 | `~/.claude/skills/{name}/reference.md` |

---

## 共通: CLAUDE.md更新ルール

### 更新箇所1: グローバルCLAUDE.md

ファイル: `~/.local/share/chezmoi/dot_claude/CLAUDE.md`

「スキル優先マッピング」テーブルに行を追加/更新:
```
| {トリガーキーワード} | `/{skill-name}` | - |
```

### 更新箇所2: プロジェクトCLAUDE.md

ファイル: `~/.local/share/chezmoi/CLAUDE.md`

「Directory Structure」のskillsリストにスキル名を追加（アルファベット順）。

---

## 共通: 適用と検証

```bash
chezmoi diff    # 差分確認
chezmoi apply   # 適用
```

### 検証チェックリスト

- [ ] SKILL.mdのfrontmatterが正しいYAML形式
- [ ] descriptionが1024文字以内
- [ ] SKILL.mdが500行以下
- [ ] reference.md（あれば）の参照が1レベルのみ
- [ ] CLAUDE.mdのスキルマッピングが更新済み
- [ ] `chezmoi apply` が成功

---

## テンプレート・アンチパターン

詳細は `~/.claude/skills/managing-skills/reference.md` を参照。
