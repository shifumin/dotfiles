---
description: PRレビューコメントを分析し、修正方針を提案する。
  「レビューコメント対応」「PRコメント対応」「review-pr-comment」「コメントに対応」などのリクエストで使用。
---

# Reviewing PR Comments

PRレビューコメントのURLを受け取り、指摘内容を分析して修正必要性の判断と修正方針を提案する。

コメントURLを引数で受け取る。省略時はAskUserQuestionで確認。

---

## 処理フロー

### 1. コメント情報の取得

URL `https://github.com/<owner>/<repo>/pull/<number>#discussion_r<comment_id>` または `#issuecomment-<id>` からowner/repo/number/comment_idを抽出。

並列実行:

```bash
# PR基本情報
gh pr view <number> --repo <owner>/<repo> --json title,body,state,author,headRefName,baseRefName,url

# 全レビューコメント取得
gh api repos/<owner>/<repo>/pulls/<number>/comments --jq '.[] | {id, body, user: .user.login, path, line, created_at, in_reply_to_id}'

# PRレベルのコメント（issue comment形式の場合）
gh api repos/<owner>/<repo>/issues/<number>/comments --jq '.[] | {id, body, user: .user.login, created_at}'

# PR diff
gh pr diff <number> --repo <owner>/<repo>
```

取得した全コメントから、対象コメントIDに一致するものを特定する。

### 2. コメント内容の分析

対象コメントから以下を把握:

| 項目 | 確認内容 |
|------|---------|
| 対象ファイル・行番号 | `path`と`line`フィールド |
| 指摘の種類 | バグ指摘、設計改善、スタイル、質問、提案 |
| スレッド | `in_reply_to_id`で会話の流れを追跡 |
| リンク | コメント内URLをWebFetchで確認 |
| 画像 | コメント内の画像URLをcurlでダウンロードしReadで確認 |

### 3. 対象コードの調査

```bash
# 対象ファイルの確認（Readツール使用）
# コメントのpathフィールドが示すファイルを読む
```

対象ファイルをReadツールで読み込む。必要に応じて関連ファイルも確認:

| 関連ファイル | 確認条件 |
|------------|---------|
| テストファイル | テスト追加・修正が必要そうな指摘 |
| 型定義・インターフェース | API変更に関する指摘 |
| 設定ファイル | 設定に関する指摘 |

Breaking Changesや影響範囲の確認にはGrepツールで使用箇所を検索する。

### 4. 修正必要性の判断

| 観点 | チェック内容 |
|------|------------|
| 指摘の妥当性 | 技術的に正しいか |
| PRの目的との整合性 | PR全体の変更意図と矛盾しないか |
| コーディング規約 | プロジェクトの規約に違反しているか |
| 影響範囲 | 他のコード・機能に影響するか |
| セキュリティ | 脆弱性に関わるか |

### 5. 結果の報告

---

## 出力フォーマット

```markdown
## レビューコメント分析

### PR概要
- **タイトル**: {PRタイトル}
- **ブランチ**: {head} → {base}

### 対象コメント
- **レビュアー**: @{user}
- **対象**: {path}:{line}
- **指摘内容**: {コメントの要約}

### 修正必要性: {必要 / 不要 / 要検討}

**判断理由**:
- {根拠を箇条書き}

### 修正方針（修正が必要な場合）

#### 方針1: {方針名}
- **変更内容**: {具体的な修正内容}
- **メリット**: {メリット}
- **デメリット**: {デメリット}

（複数方針がある場合は追加）

**推奨**: 方針{X}
**理由**: {推奨理由}

### 次のステップ
1. {具体的なアクション}
```

### 判断基準

| 修正必要性 | 条件 |
|-----------|------|
| 必要 | バグ指摘、セキュリティ問題、明確な規約違反 |
| 要検討 | 設計方針の相違、トレードオフがある提案 |
| 不要 | 好みの問題、既に対応済み、誤解に基づく指摘 |

**不要の場合も理由を明確に説明する。**

---

## エラー処理

| エラーパターン | 対処 |
|---------------|------|
| コメントIDが見つからない | `gh api`で全コメントを再取得し、URL内のIDと照合 |
| PRがクローズ済み | 情報取得は可能。修正が必要な場合はその旨を報告 |
| リポジトリへのアクセス権なし | `gh auth status`で認証確認を案内 |
| コメント内リンクがアクセス不可 | リンク先を確認できなかった旨を報告し、指摘内容のみで判断 |

---

## 他スキルとの使い分け

| 操作 | 使用先 |
|------|--------|
| レビューコメントへの対応分析 | **このスキル** |
| PR/Issue情報取得・作成 | `/github` |
| 深いコードレビュー | `/review-pr` |
| commit + push | `/push` |
