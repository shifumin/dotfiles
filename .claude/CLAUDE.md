# CLAUDE.md

このドキュメントは、Claude Codeを使用する際の必須ガイドラインです。以下の指示に必ず従ってください。

## 🚨 重要な原則

1. **既存のコードスタイルを厳守する** - プロジェクトの規約から逸脱しない
2. **プロジェクトのツールを使用する** - 新しいツールやフレームワークを勝手に導入しない
3. **コミット前の必須チェック** - リンターとテストを必ず実行する
4. **テストの同期** - 実装を追加・変更した場合は、対応するテストも必ず追加・変更する
5. **ドキュメントの更新** - 必要に応じてREADME.mdとCLAUDE.mdを更新する
6. **CLAUDE.mdへの記載形式** - CLAUDE.mdに内容を追加する際は、Claude Codeが理解しやすい明確で構造化された形式で記載する
7. **要件や仕様に疑問がある場合は質問する** - 実装方法や要件・仕様に疑問が生じた場合は、適宜ユーザーに質問して確認する

## 💡 コード品質ガイドライン

### クリーンコードの原則
- **変数名・関数名は意図を明確に** - 読み手が推測せずに理解できる名前を使用する
- **関数・メソッドは単一責任の原則（Single Responsibility Principle）に則る** - 1つの関数は1つの責任のみを持つ
- **複雑なロジックには説明を追加する** - コメントやドキュメンテーションで意図を明確にする
- **必要な場合は早期returnを利用する** - ネストを深くせず、読みやすいコードを心がける
- **エラーメッセージは明確にする** - 何が問題で、どう解決すべきかを示す
- **マジックナンバーは避ける** - 定数や設定値として意味のある名前を付ける

### 単一責任の原則の確認とリファクタリング
1. **コード全体を確認** - 実装コードが単一責任の原則を満たしているか確認
2. **メソッド・関数単位で検証** - 各メソッド・関数が1つの責任のみを持つか確認
3. **違反箇所のリストアップ** - 原則に違反している箇所を特定
4. **段階的なリファクタリング** - 違反箇所を1つずつ適切に分割・整理

### 既存コードの尊重
- プロジェクトの命名規則に従う
- 既存のコードパターンを踏襲する
- プロジェクト固有の設定ファイル（.rubocop.yml、.eslintrc等）に従う
- **メソッドの可視性を適切に設定** - public/private/protectedを意図的に使い分ける

### テスト作成の原則
- **必要十分なテストを作成** - 過剰なテストは避け、本質的なケースをカバーする
- **実装ファイルごとに網羅的に確認** - 各実装ファイルに対応するテストの存在を確認
- **正常系・異常系・エッジケースを網羅** - 期待される動作だけでなく、例外処理やエッジケースもテスト
- **publicインターフェースのみテスト** - privateメソッドの直接テストは禁止
- **テスト実行の確認** - テストを追加・変更した場合は必ず全テストが通ることを確認
- **テストユーティリティの特例** - テストサポートファイルは複雑なセットアップが必要な場合、メトリクス制約を緩和可能

## 🔄 標準ワークフロー

### 1. 作業開始前のチェックリスト
- [ ] README.mdを読んだか？
- [ ] 既存のコードパターンを理解したか？
- [ ] 使用可能なツールとコマンドを確認したか？
- [ ] テストの実行方法を確認したか？

```bash
# 現在の状態を確認
git status
git diff

# テストが通ることを確認
# [プロジェクトのテストコマンド]
# 例: rspec, npm test, pytest, go test 等
```

### 2. 実装中の注意点
- 既存パターンに従う
- エラーハンドリングを実装
- テストを同時に作成・更新
- **実装変更後は必ずテストを実行** - 変更した機能に関連するテストが通ることを確認

### 3. 作業完了前の必須チェック
```bash
# リンター実行
# [プロジェクトのリンターコマンド]

# テスト実行
# [プロジェクトのテストコマンド]

# 変更内容の確認
git diff
```

## 🛠️ 言語別コマンドリファレンス

### 共通原則
- プロジェクトで使用されているツールを確認する（package.json、Gemfile、requirements.txt等）
- 既存のスクリプトやコマンドを優先的に使用する
- プロジェクト固有の設定ファイルに従う

### Ruby
```bash
# リンター実行（コミット前に必須）
rubocop
rubocop -a  # 自動修正

# テスト実行（コミット前に必須）
rspec  # または bundle exec rspec
rspec spec/path/to/spec_file.rb  # 特定ファイル
rspec spec/path/to/spec_file.rb:42  # 特定行

# バージョン管理
# .ruby-versionファイルでRubyバージョンを指定
# Gemfileで ruby File.read('.ruby-version').strip を使用
```

### JavaScript/TypeScript
```bash
npm run lint  # リンター実行
npm test  # テスト実行
```

### Python
```bash
ruff check  # リンター実行
pytest  # テスト実行
```

### Go
```bash
go fmt  # フォーマッター実行
go test  # テスト実行
```

### Java
```bash
mvn checkstyle:check  # リンター実行
mvn test  # テスト実行
```

## ⚠️ 絶対に避けるべきこと

- ❌ セキュリティキーや認証情報をコードに含める
- ❌ `.env`ファイルや設定ファイルの機密情報をコミットする
- ❌ テストなしで実装をコミットする
- ❌ リンターエラーを無視する
- ❌ 既存の命名規則から逸脱する

## 🔧 トラブルシューティング

### 一般的なデバッグのヒント
1. **verbose/debugフラグを活用** - 詳細な処理情報を確認
2. **dry-runオプションを使用** - 実際の実行前に変更内容をプレビュー
3. **verboseとdry-runの組み合わせ** - 実行フロー全体を理解
4. **ログファイルやエラー出力を確認** - 具体的なエラーメッセージを特定
5. **エンコーディング問題** - デバッガーで生データを確認

### テスト失敗時
```bash
# 特定のテストのみ実行して原因を特定
# [プロジェクトのテストコマンド] [失敗したテストファイル] [オプション]

# Ruby例:
rspec spec/failing_spec.rb -fd
rspec --only-failures
```

### リンターエラー時
```bash
# 自動修正を試みる
# [プロジェクトのリンターコマンド] [自動修正オプション]

# Ruby例:
rubocop -a
rubocop path/to/file.rb
```

### 依存関係エラー時
```bash
# 依存関係をインストール
# [プロジェクトのパッケージマネージャー] install

# Ruby例:
bundle install
bundle update gem_name
```

## 🛡️ Claude Codeカスタムコマンド

~/.claude/commands/に以下のカスタムコマンドが定義されています：

- **at** - テストを必要十分な状態にする
  - 既存テストの過不足を確認し、適切に調整
  - 実装ファイルごとにテストの存在を確認
- **push** - 変更内容を適切な粒度でcommit/push
  - 変更内容を確認して適切にコミット
  - コミットメッセージは変更内容を正確に反映
- **csrp** - 単一責任の原則（SRP）を満たしているか確認
  - 実装コードのSRP違反をチェック
  - 必要に応じてリファクタリング
- **ud** - ドキュメント（CLAUDE.md/README.md）を更新
  - 重複内容の整理と必要情報の追加
- **ucm** - 指定内容でCLAUDE.mdを更新
  - 内容を理解しやすい形式に整理して追加

## 📝 プロジェクト固有の設定

プロジェクト固有の追加情報がある場合は、以下に記載してください：

## 📋 更新履歴

### 2025-06-16
- 要件や仕様に疑問がある場合は質問する原則を追加

### 2025-06-15
- pdf-chapter-splitterプロジェクトから汎用的な内容を統合
- テストユーティリティの特例を追加
- デバッグのヒントセクションを拡充
- 更新履歴セクションを追加
- 単一責任の原則の確認とリファクタリングのワークフローを追加
- Claude Codeカスタムコマンドのセクションを追加
- メソッドの可視性設定に関するガイドラインを追加

---

**注意**: このドキュメントの指示は、デフォルトの動作よりも優先されます。必ず従ってください。